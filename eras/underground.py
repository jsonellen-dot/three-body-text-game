"""
地下纪元模块
人类转入地下世界的生存与抵抗
"""

def underground_era_1(game):
    """地下纪元：地下文明"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：地下文明
═══════════════════════════════════════

【地下纪元开始】

人类放弃了地表。

维德在最后的广播中宣布：
"从今天起，地表属于三体人。
但地下，永远属于人类！"

在全球各地，新的文明在地下诞生：

**地球地下城市：**

**亚洲：**
- 北京地下城：5000万人口
  （利用地铁系统和防空洞）
- 上海地下城：4000万人口
  （利用黄浦江地下空间）
- 东京地下城：3000万人口
  （利用地下商业街）

**美洲：**
- 纽约地下城：3000万人口
  （利用地铁和下水道）
- 洛杉矶地下城：2000万人口
  （利用地下停车场）

**欧洲：**
- 伦敦地下城：2000万人口
  （利用地铁系统）
- 巴黎地下城：1500万人口
  （利用地下墓穴）

**总计：全球50个地下城，20亿人口**

**火星地下殖民地：**
- 奥林帕斯地下城：500万人口
- 水手谷地下城：300万人口

罗辑负责总体规划：
"地下世界自给自足。
我们可以在这里生存几百年。"

**地下农场：**
AA负责农业：
"我们用LED模拟阳光，
种植小麦、水稻、蔬菜。
虽然产量只有地表的30%，
但足够维持基本生存。"

**地下工厂：**
维德负责军工：
"我们在地下秘密生产武器。
三体人不知道我们的实力。
总有一天，我们会反攻！"

**地下学校：**
程心负责教育：
"孩子们从未见过真正的天空，
但我们必须让他们记住，
地表曾经属于人类。

我们教他们历史、文化、科学...
让他们知道，人类不是地下的老鼠，
而是暂时避难的文明。"

**地下医院、图书馆、博物馆...**

三体人控制地表，人类统治地下。

这是一种奇特的共存。

智子偶尔会来到地下城：
"人类，你们就像地鼠一样。
永远躲在黑暗中。"

维德冷笑："至少我们还活着。"

一百年过去了。

地下文明已经完全成熟：
- 人口增长到30亿
- 科技独立发展
- 文化独具特色

新一代地下人类已经适应了没有阳光的生活。

他们不知道天空是什么颜色，
不知道风是什么感觉，
不知道雨是什么味道...

但他们很幸福。

地下就是他们的世界。

程心看着在地下公园玩耍的孩子们，
流下了眼泪：
"他们从未见过真正的太阳..."

罗辑安慰她：
"但他们活着。
这就够了。"

维德召开军事会议：
"我们在地下积蓄了足够的力量。
是时候反攻了！"

你必须决定地下文明的未来：

1. 【永居地下】接受现实，在地下永久生存
2. 【地下反击】积蓄力量，从地下反攻地表
3. 【深入地心】向地球深处挖掘，寻找更安全的地方""")
    
    game.add_button("选择1", lambda: game.choice(2, 1, 2, 0, 2, underground_era_2_permanent))
    game.add_button("选择2", lambda: game.choice(1, 1, 0, 3, 1, underground_era_2_counterattack))
    game.add_button("选择3", lambda: game.choice(1, 3, 0, 0, 1, underground_era_2_deep))

def underground_era_2_permanent(game):
    """地下纪元：永久定居"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：地下王国
═══════════════════════════════════════

你选择了永居地下。

维德愤怒："我们要放弃地表吗？"

罗辑平静地说：
"地表已经不属于我们了。
与其无谓的牺牲，
不如在地下建立永久的文明。"

程心支持："孩子们在地下很幸福。
为什么要让他们去送死？"

维德最终妥协：
"好吧...但我们要保持军事力量，
以防三体人进攻地下。"

又过了一百年。

地下文明完全成熟：

**地下王国的特征：**

**政治：**
- 地下联邦政府
- 50个地下城市自治
- 民主选举制度

**经济：**
- 地下货币体系
- 地下贸易网络
- 资源循环利用

**文化：**
- 地下艺术（雕塑、绘画）
- 地下音乐（回声音乐）
- 地下文学（黑暗浪漫主义）

**科技：**
- 地下能源（地热、核聚变）
- 地下交通（磁悬浮列车）
- 地下通讯（量子网络）

新一代人类完全适应了地下生活。

他们创造了独特的地下文化：
- "黑暗节"（庆祝地下生活）
- "回声诗"（利用地下空间的回声）
- "洞穴画"（在岩壁上作画）

程心已经老了，她对孙女说：
"奶奶小时候，生活在地表。
那里有蓝天、白云、阳光..."

孙女好奇："地表是什么样的？"

程心笑着："很美...但也很危险。
地下才是我们的家。"

罗辑在临终前说：
"我们失去了地表，
但保存了文明。
这就够了。"

维德最后的遗言：
"也许...我们不需要地表。
地下，也可以是天堂。"

三百年后，地下人类已经忘记了地表。

他们的历史书中写道：
"人类曾经生活在地表，
但那是野蛮的时代。
地下文明，才是真正的文明。"

你必须决定最终的命运：

1. 【永恒地下】在地下永远生存下去
2. 【重返地表】新一代想看看传说中的地表""")
    
    from .endings import ending
    game.add_button("选择1", lambda: game.choice(2, 2, 2, 0, 3, lambda g: ending(g, "underground_kingdom")))
    game.add_button("选择2", lambda: game.choice(1, 1, 2, 1, 2, underground_era_3_return))

def underground_era_2_counterattack(game):
    """地下纪元：地下反击"""
    # 这个函数在 dark.py 中已经定义，这里只是占位
    from .dark import underground_era_2_counterattack as counter
    counter(game)

def underground_era_2_deep(game):
    """地下纪元：深入地心"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：地心探索
═══════════════════════════════════════

罗辑提出了疯狂的计划：

"我们可以向地球深处挖掘！
在地幔层建立城市！

那里有：
- 无尽的地热能源
- 丰富的矿产资源
- 三体人无法到达的深度

我们可以在地心建立真正安全的避难所！"

维德支持："这是个好主意。
地表太危险，
现在的地下城市也太浅（只有几百米）。

如果我们能到达地下5000米，
甚至10000米，
三体人永远找不到我们！"

程心担忧："但那里的温度、压力...
人类能生存吗？"

AA负责工程：
"我们可以用三体技术建造耐高温高压的城市。
理论上可行。"

挖掘开始！

**深度记录：**
- 1000米：温度40°C，可居住
- 2000米：温度60°C，需要冷却系统
- 3000米：温度80°C，建立中转站
- 4000米：温度100°C，发现巨大洞穴
- 5000米：温度120°C，发现...

在地下5000米处，
挖掘队发现了一个惊人的秘密：

一个巨大的地下空间！

比任何地下城市都大！

而且...里面有建筑！

古老的、非人类的建筑！

罗辑震惊："这是...史前文明？"

维德命令："继续探索！"

探索队进入建筑。

墙上刻着奇怪的文字和图案。

AA破译了部分内容：

"警告...不要...深入...
地心...有...恐怖..."

程心害怕："我们应该停下！"

但维德坚持："继续！"

探索队继续深入。

在建筑的中心，
他们发现了一个巨大的装置。

装置突然启动！

一个声音响起：
"检测到智慧生命...
启动防御程序..."

地震开始！

地下5000米的空间开始坍塌！

探索队拼命逃跑！

罗辑在地面指挥中心：
"所有人撤离！
关闭挖掘通道！"

最终，只有一半的探索队逃了出来。

维德看着坍塌的通道：
"地心...有什么东西..."

程心颤抖："我们不该去那里..."

你必须决定：

1. 【继续挖掘】不管有什么，我们必须到达地心
2. 【停止挖掘】地心太危险，放弃这个计划""")
    
    from .endings import ending
    game.add_button("选择1", lambda: game.choice(0, 3, -2, 2, 0, lambda g: ending(g, "underground_core")))
    game.add_button("选择2", lambda: game.choice(2, 0, 2, 0, 2, lambda g: ending(g, "underground_fear")))

def underground_era_3_return(game):
    """地下纪元：重返地表"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：重返地表
═══════════════════════════════════════

三百年后，新一代地下人类对地表充满好奇。

一个年轻人对程心的曾孙女说：
"我想看看传说中的天空。"

曾孙女（现在是地下联邦总统）决定：
"我们派遣探索队，重返地表！"

探索队穿上防护服，
通过废弃的地铁隧道，
来到了地表。

他们看到的是：

**地表的现状：**
- 三体人已经撤离（他们的母星被摧毁）
- 城市废墟被植物覆盖
- 野生动物重新繁衍
- 空气清新，天空湛蓝

探索队队长通过通讯器报告：
"地表...很美。
三体人走了。
我们可以回家了！"

地下人类欢呼雀跃！

大规模的回归开始：

**第一批：**
- 100万人返回地表
- 清理废墟
- 重建城市

**第二批：**
- 1000万人返回
- 恢复农业
- 重建工业

**第三批：**
- 10亿人返回
- 地下城市逐渐废弃
- 人类重新成为地表文明

程心的曾孙女站在天安门广场，
第一次看到真正的太阳：

"这就是太阳...
这就是祖先们说的阳光..."

她哭了。

三百年的地下生活，
终于结束了。

人类重返地表。

但他们永远不会忘记：
那段在黑暗中生存的岁月。

═══════════════════════════════════════
结局：重返地表
生存: {survival} | 科技: {technology} | 道德: {morality}
═══════════════════════════════════════

人类重新成为地表文明。

他们在废墟上重建了城市。

但他们保留了地下城市，
作为博物馆和避难所。

新的历史书中写道：
"人类曾经在地下生存了三百年。
那是最黑暗的时代，
也是最坚韧的时代。

我们失去了阳光，
但没有失去希望。

我们在黑暗中生存，
最终重返光明。"

地下纪元，成为传奇。""")
    
    game.add_button("重新开始", lambda: game.choice(0, 0, 0, 0, 0, game.start_game))

def underground_era_3_defense(game):
    """地下纪元：地表防御战"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：地表防御战
═══════════════════════════════════════

你选择坚守地表城市。

维德在北京天安门广场下令：
"所有人，死守阵地！
我们不会再退回地下！"

三体舰队抵达。

智子冷笑："人类，你们真是顽强。
但这次，我们会彻底消灭你们。"

**北京保卫战：**
- 人类：10万守军
- 三体：100万机器人军队
- 战况：激烈

**上海保卫战：**
- 人类：8万守军
- 三体：80万机器人
- 战况：惨烈

**纽约保卫战：**
- 人类：6万守军
- 三体：60万机器人
- 战况：绝望

罗辑在地下指挥中心：
"我们守不住...
伤亡太大了..."

程心哭泣："撤退吧！
不要再牺牲了！"

维德拒绝："不！
我们已经退无可退！
这是人类的最后一战！"

战斗持续了三天三夜。

最终：
- 北京失守，守军全灭
- 上海失守，守军全灭
- 纽约失守，守军全灭

维德在最后的通讯中说：
"我们失败了...
但我们战斗到了最后...
人类...永不屈服..."

通讯中断。

三体人占领了所有地表城市。

幸存的人类撤回地下。

═══════════════════════════════════════
结局：地表失守
生存: {survival} | 科技: {technology} | 道德: {morality}
═══════════════════════════════════════

人类失去了地表。

但在地下，抵抗仍在继续。

维德的牺牲激励了所有人。

新一代抵抗军发誓：
"总有一天，我们会夺回地表！"

地下纪元，继续...""")
    
    game.add_button("重新开始", lambda: game.choice(0, 0, 0, 0, 0, game.start_game))

def underground_era_3_guerrilla(game):
    """地下纪元：地下游击战"""
    game.clear_buttons()
    game.show_text("""═══════════════════════════════════════
    地下纪元：地下游击战
═══════════════════════════════════════

你选择撤回地下，打持久战。

维德在撤退命令中说：
"保存实力，继续抵抗！
游击战，才是我们的优势！"

人类撤回地下。

但抵抗没有停止：

**游击战术：**
- 夜间突袭三体设施
- 破坏补给线
- 刺杀三体军官
- 然后迅速撤回地下

三体人无法追击到地下深处。

智子愤怒："这些老鼠！"

游击战持续了五十年。

三体人损失惨重：
- 补给站被炸毁
- 军官被刺杀
- 士气低落

最终，三体议会决定：
"地球的代价太大了。
我们撤离。"

三体舰队撤离地球。

人类重新夺回地表！

维德在天安门广场宣布：
"我们胜利了！
游击战，证明了人类的韧性！"

═══════════════════════════════════════
结局：游击战胜利
生存: {survival} | 科技: {technology} | 道德: {morality}
═══════════════════════════════════════

人类用游击战赢得了胜利。

这场战争被载入史册：
"地下游击战：人类最伟大的胜利"

维德成为传奇：
"游击战之父"

人类重返地表，
重建文明。

但他们永远记得：
在黑暗中战斗的岁月。""")
    
    game.add_button("重新开始", lambda: game.choice(0, 0, 0, 0, 0, game.start_game))
